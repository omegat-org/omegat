plugins {
    id 'org.omegat.common-utilities'
}

tasks.register('checksums') {
    def algos = ['SHA-512']
    description = "Generates ${algos.join(', ')} checksums for distribution files."
    inputs.files fileTree(dir: base.distsDirectory, exclude: 'checksums')
    outputs.dir base.distsDirectory.dir('checksums')
    onlyIf {
        condition(base.distsDirectory.get().asFile.directory, 'Distfiles not found')
    }
    doLast {
        base.distsDirectory.get().asFile.listFiles().findAll { it.file }.each { f ->
            algos.each { algo ->
                ant.checksum file: f, algorithm: algo, todir: distsDirectory.dir('checksums').get().asFile
            }
        }
    }
}

