<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~  OmegaT - Computer Assisted Translation (CAT) tool
  ~           with fuzzy matching, translation memory, keyword search,
  ~           glossaries, and translation leveraging into updated projects.
  ~
  ~  Copyright (C) 2025 Hiroshi Miura
  ~                Home page: https://www.omegat.org/
  ~                Support center: https://omegat.org/support
  ~
  ~  This file is part of OmegaT.
  ~
  ~  OmegaT is free software: you can redistribute it and/or modify
  ~  it under the terms of the GNU General Public License as published by
  ~  the Free Software Foundation, either version 3 of the License, or
  ~  (at your option) any later version.
  ~
  ~  OmegaT is distributed in the hope that it will be useful,
  ~  but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~  GNU General Public License for more details.
  ~
  ~  You should have received a copy of the GNU General Public License
  ~  along with this program.  If not, see <https://www.gnu.org/licenses/>.
  -->
<FindBugsFilter
        xmlns="https://github.com/spotbugs/filter/4.8.4"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="https://github.com/spotbugs/filter/4.8.4 https://raw.githubusercontent.com/spotbugs/spotbugs/4.8.4/spotbugs/etc/findbugsfilter.xsd">
    <!-- All classes generated by jaxb -->
    <Match>
        <Package name="~gen.core.*" />
    </Match>
    <!-- Generated class by NetBeans GUI editor  -->
    <Match>
        <Or>
            <Class name="~.*\.gui\.dialogs\.*Dialog" />
            <Class name="~.*\.gui\.preferences\.view\.*Panel" />
        </Or>
        <Not>
            <Bug pattern="PA" />
        </Not>
    </Match>
    <!-- Skip deprecated classes -->
    <Match>
        <Class name="org.omegat.util.xml.XMLReader" />
    </Match>
    <!-- Skip Core class warnings caused by application class design issue.
       Core class is designed to store application status as static fields
       and expose it around the application.
       This is not thread safe, test unfriendly, and possible problems.
     -->
    <Match>
        <Class name="org.omegat.core.Core"/>
        <Bug pattern="EI_EXPOSE_REP,EI_EXPOSE_REP2,MS_EXPOSE_REP"/>
    </Match>
    <!-- Skip EI and EI2 warnings on core packages that are caused by application design issue -->
    <Match>
        <Or>
            <Class name="org.omegat.core.data.ProjectProperties" />
            <Class name="org.omegat.core.data.RealProject" />
        </Or>
        <Bug pattern="EI_EXPOSE_REP,EI_EXPOSE_REP2"/>
    </Match>

    <!-- CoreState.getInstance returns the instance object in design. -->
    <Match>
        <Class name="org.omegat.core.data.CoreState"/>
        <Bug pattern="MS_EXPOSE_REP"/>
    </Match>

    <!-- Plugin manager exposes lists of classes in design. suppress until design reconstruction -->
    <Match>
        <Class name="org.omegat.filters2.master.PluginUtils" />
        <Bug pattern="MS_EXPOSE_REP" />
    </Match>
    <!-- filters3 XML classes expose in original design -->
    <Match>
        <Or>
            <Class name="org.omegat.filters3.xml.DefaultXMLDialect" />
            <Class name="org.omegat.filters3.xml.Handler" />
            <Class name="org.omegat.filters3.xml.XMLEntityText" />
        </Or>
        <Bug pattern="EI_EXPOSE_REP,EI_EXPOSE_REP2" />
    </Match>
    <!-- Preferences/view classes getGui() method expose object in API design -->
    <Match>
        <Class name="~org\.omegat\.gui\.preferences\.view\..*Controller" />
        <Method name="getGui" />
        <Bug pattern="EI_EXPOSE_REP" />
    </Match>
    <!-- All bugs in test classes, except for JUnit-specific bugs -->
    <Match>
        <Class name="~.*\..*Test" />
        <Not>
            <Bug code="IJU" />
        </Not>
    </Match>
    <Match>
        <Class name="org.omegat.core.TestCoreWireMock"/>
        <Bug pattern="URF_UNREAD_PUBLIC_OR_PROTECTED_FIELD"/>
    </Match>
    <Match>
        <Class name="~org\.omegat\.core\.data\.TestTeamIntegration.*"/>
    </Match>

    <!-- All EI/EI2 are ignored for the first step -->
    <Match>
        <Bug pattern="CT_CONSTRUCTOR_THROW,EI_EXPOSE_REP,EI_EXPOSE_REP2,EI_EXPOSE_STATIC_REP2,RV_RETURN_VALUE_IGNORED_BAD_PRACTICE" />
    </Match>
    <!-- PA is ignored for the first step -->
    <Match>
        <Bug pattern="PA_PUBLIC_PRIMITIVE_ATTRIBUTE"/>
    </Match>
    <!-- SF_SWITCH_NO_DEFAULT is ignored for the first step -->
    <Match>
        <Bug pattern="SF_SWITCH_NO_DEFAULT"/>
    </Match>
    <!-- OmegaT supports Java 11 but primary target is Java 17 -->
    <Match>
        <Bug pattern="DP_CREATE_CLASSLOADER_INSIDE_DO_PRIVILEGED"/>
    </Match>


    <!-- Deprecated classes warnings -->
    <Match>
        <Class name="org.omegat.util.JsonParser"/>
    </Match>

    <!-- GlossaryTextArea class has so many issues that should be fixed. -->
    <Match>
        <Class name="org.omegat.gui.glossary.GlossaryTextArea"/>
    </Match>

    <!-- DateFormat multithreading issue -->
    <Match>
        <Class name="~org\.omegat\.gui\.editor\.ModificationInfoManager.*"/>
        <Bug pattern="STCAL_INVOKE_ON_STATIC_DATE_FORMAT_INSTANCE"/>
    </Match>

    <!-- should be fixed in the individual topic branch -->
    <Match>
        <Bug pattern="NP_NULL_ON_SOME_PATH_FROM_RETURN_VALUE,DCN_NULLPOINTER_EXCEPTION"/>
    </Match>
    <Match>
        <Bug pattern="NP_LOAD_OF_KNOWN_NULL_VALUE"/>
        <Or>
            <Class name="org.omegat.gui.dialogs.ConflictDialogController"/>
            <Class name="org.omegat.gui.matches.MatchesTextArea"/>
        </Or>
    </Match>
    <Match>
        <Bug pattern="RCN_REDUNDANT_NULLCHECK_OF_NONNULL_VALUE"/>
        <Or>
            <Package name="org.omegat.gui.glossary"/>
        </Or>
    </Match>

    <!-- Multithreaded correctness warnings should be fixed -->
    <Match>
        <Bug pattern="AT_STALE_THREAD_WRITE_OF_PRIMITIVE,AT_NONATOMIC_OPERATIONS_ON_SHARED_VARIABLE"/>
    </Match>
    <Match>
        <Or>
            <Package name="org.omegat.core.threads"/>
            <Class name="org.omegat.core.data.RealProject"/>
            <Class name="org.omegat.gui.dialogs.NewTeamProjectController"/>
        </Or>
        <Bug pattern="IS2_INCONSISTENT_SYNC"/>
    </Match>

    <!-- Switch fallthrough is not recommended -->
    <Match>
        <Bug pattern="SF_SWITCH_FALLTHROUGH"/>
        <Class name="org.omegat.gui.issues.TagIssue"/>
    </Match>

    <!-- should be fixed the writing to static field from instance -->
    <Match>
        <Or>
            <Class name="org.omegat.filters2.mozdtd.MozillaDTDFilter"/>
            <Class name="org.omegat.gui.editor.ViewLabel"/>
            <Class name="~org\.omegat\.gui\.scripting.*"/>
            <Class name="org.omegat.util.gui.OSXIntegration"/>
        </Or>
        <Bug pattern="ST_WRITE_TO_STATIC_FROM_INSTANCE_METHOD"/>
    </Match>

    <!-- Ignores positive-false detections -->
    <Match>
        <Or>
            <Class name="org.omegat.gui.align.Aligner"/>
            <Class name="org.omegat.filters4.xml.xliff.AbstractXliffFilter"/>
            <Class name="org.omegat.filters3.xml.xliff.XLIFFFilter"/>
            <Class name="org.omegat.filters2.AbstractFilter"/>
            <Class name="org.omegat.filters2.po.PoFilter"/>
        </Or>
        <Bug pattern="NP_NULL_ON_SOME_PATH"/>
    </Match>

    <!-- Temporarily exclude to enable minimum chechks -->
    <Match>
        <Class name="org.omegat.util.Platform"/>
        <Bug pattern="DE_MIGHT_IGNORE"/>
    </Match>
    <Match>
        <Or>
            <Class name="org.omegat.core.data.RealProject"/>
            <Class name="org.omegat.gui.editor.SegmentBuilder"/>
            <Class name="org.omegat.core.threads.SaveThread"/>
        </Or>
        <Bug pattern="DM_EXIT"/>
    </Match>
    <Match>
        <Or>
            <Class name="org.omegat.core.search.SearchMatch"/>
            <Class name="org.omegat.core.dictionaries.DictionaryEntry"/>
            <Class name="org.omegat.gui.scripting.ScriptItem"/>
        </Or>
        <Bug pattern="EQ_COMPARETO_USE_OBJECT_EQUALS"/>
    </Match>
    <Match>
        <Or>
            <Class name="org.omegat.util.EncodingDetector"/>
            <Class name="org.omegat.util.StaticUtils"/>
        </Or>
        <Bug pattern="RR_NOT_CHECKED"/>
    </Match>
    <Match>
        <Or>
            <Class name="org.omegat.gui.dictionaries.DictionariesTextArea"/>
            <Class name="org.omegat.gui.editor.EditorTextArea3"/>
            <Class name="org.omegat.gui.matches.MatchesTextArea"/>
            <Class name="org.omegat.gui.multtrans.MultipleTransPane"/>
            <Class name="~org\.omegat\.core\.matching\.NearString.*"/>
            <Class name="~org\.omegat\.gui\.glossary\.GlossaryAutoCompleterView.*"/>
            <Class name="~org\.omegat\.util\.FileUtil.*"/>
        </Or>
        <Bug pattern="SE_BAD_FIELD,SE_COMPARATOR_SHOULD_BE_SERIALIZABLE"/>
    </Match>
    <Match>
        <Or>
            <Class name="org.omegat.filters2.hhc.HHCFilter2"/>
            <Class name="~org\.omegat\.filters2\.subtitles\..*Filter"/>
            <Class name="org.omegat.filters4.xml.xliff.SdlXliff"/>
        </Or>
        <Bug pattern="HSM_HIDING_METHOD"/>
    </Match>

    <Match>
        <Class name="org.omegat.gui.editor.EditorController"/>
        <Bug pattern="RCN_REDUNDANT_NULLCHECK_WOULD_HAVE_BEEN_A_NPE"/>
    </Match>
    <Match>
        <Or>
            <Class name="org.omegat.filters3.xml.XMLReader"/>
            <Class name="org.omegat.filters4.xml.AbstractXmlFilter"/>
            <Class name="org.omegat.gui.scripting.ScriptSet"/>
            <Class name="org.omegat.tokenizer.HunspellTokenizer"/>
        </Or>
        <Bug pattern="OS_OPEN_STREAM,OBL_UNSATISFIED_OBLIGATION,OBL_UNSATISFIED_OBLIGATION_EXCEPTION_EDGE"/>
    </Match>
    <Match>
        <Or>
            <Class name="org.omegat.core.statistics.StatsResult"/>
            <Class name="org.omegat.filters2.master.FilterMaster"/>
            <Class name="org.omegat.filters2.mozdtd.MozillaDTDFilter"/>
            <Class name="org.omegat.gui.dialogs.FilenamePatternsEditorController"/>
            <Class name="org.omegat.gui.editor.ViewLabel"/>
            <Class name="org.omegat.gui.scripting.ScriptRunner"/>
            <Class name="org.omegat.util.OStrings"/>
            <Class name="org.omegat.util.Preferences"/>
            <Class name="org.omegat.util.gui.UIDesignManager"/>
        </Or>
        <Bug pattern="MS_PKGPROTECT,MS_EXPOSE_REP"/>
    </Match>
    <Match>
        <Or>
            <Class name="org.omegat.core.machinetranslators.BaseTranslate"/>
            <Class name="~org\.omegat\.core\.spellchecker\.DictionaryManager.*"/>
            <Class name="~org\.omegat\.util\.PreferencesXML.*"/>
        </Or>
        <Bug pattern="URF_UNREAD_PUBLIC_OR_PROTECTED_FIELD,UWF_UNWRITTEN_PUBLIC_OR_PROTECTED_FIELD"/>
    </Match>
</FindBugsFilter>
