<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"../../../docbook-xml-4.5/docbookx.dtd">
<section id="windows.aligner">
  <title id="windows.aligner.title">Aligner</title>

  <para>Alignment is the process of creating a bilingual translation memory
  from a pair of already translated monolingual documents. Aligning the contents of the files is a two-step process. First, the files are read by the aligner, which attempts to match the segments that correspond to one another in the original and translated texts. Next, the translator reviews the results and makes any necessary manual adjustments.</para>

  <para>The aligner can read all the file formats supported by OmegaT. Select
  <link endterm="menus.tools.align.files.title"
  linkend="menus.tools.align.files"/> in the <link endterm="menus.tools.title"
  linkend="menus.tools"/> menu to access this tool. This brings up the
  <guilabel>Align Files</guilabel> dialog, where you specify the source and
  target languages and select the two files you want to align.</para>

  <note>
    <para>If you have a translation project open, the aligner will
    automatically use the languages from that project, as well the
    project-specific segmentation rules, if any.</para>
  </note>

  <para>Clicking the <guibutton>OK</guibutton> button in the<guilabel>Align Files</guilabel> dialog brings up the <guilabel>Align</guilabel> window, which shows the results of the automatic alignment.</para>

  <para>The main part of the window is divided into three columns:
    <itemizedlist>
        <listitem>
          <para><guilabel>Keep</guilabel>: The segment pairs in rows that have this check box ticked are saved to the translation memory file. Unticked rows are discarded.</para>
        </listitem>

        <listitem>
          <para><guilabel>Source</guilabel>: The segments from the original
          text.</para>
        </listitem>

        <listitem>
          <para><guilabel>Target</guilabel>: The segments from the translated
          text.</para>
        </listitem>
      </itemizedlist>
  </para>

  <section id="windows.aligner.adjust">
    <title id="windows.aligner.adjust.title">Step 1: Adjust alignment
    parameters</title>

    <para>In this step, the bottom part of the window presents various
    parameters and options you can change if the initial alignment looks like
    it could be improved. It also shows an <guilabel>Average score</guilabel> result for the alignement. As a rule of thumb, the lower
    that score, the more accurate the alignment. Changing a parameter immediately recalculates the alignment, allowing you to quickly try different combinations to obtain the best results.</para>
    
    <para>The available parameters and options are:</para>

    <variablelist>
      <para><emphasis>Parameters</emphasis></para>
      <varlistentry>
        <term><guilabel>Comparison mode</guilabel></term>        
          <listitem>
            <itemizedlist>
              <listitem>
                <para><guilabel>Heapwise</guilabel>: This mode compares the documents globally.</para>
              </listitem>
              <listitem>
                <para><guilabel>Parsewise</guilabel>: This mode compares the documents segment by segment. It is only shown when it is available for the files being aligned.</para>
              </listitem>
              <listitem>
                <para><guilabel>ID</guilabel>: This mode applies to files consisting of <literal>key = value</literal> entries. This works even if the order of the keys differ in each file, and when the files have a different number of entries. It is only shown when both selected files are recognized as key=value files.</para>
              </listitem>            
            </itemizedlist>
          </listitem>
        </varlistentry>
      <varlistentry>
        <term><guilabel>Algorithm:</guilabel></term>
          <listitem>
            <itemizedlist>
              <listitem>
                <para><guilabel>Viterbi</guilabel>: The default algorithms used to align the documents.</para> 
              </listitem>
              <listitem><para><guilabel>Forward-Backward</guilabel>: An alternative algorithm that can be used to align the documents.</para></listitem>
              </itemizedlist>
              <para>There is no hard and fast rule on which algorithm is you should choose. Try both, and use the one that yields the better results for your files.</para>
          </listitem>        
      </varlistentry>
      <varlistentry>
        <term><guilabel>Calculator:</guilabel></term>
          <listitem>
            <itemizedlist>
              <listitem>
                <para><guilabel>Normal</guilabel>: The default statistical distribution used to align the documents.</para>
              </listitem>
              <listitem>
                <para><guilabel>Poisson</guilabel>: An alternative statistical distribution that can be used to align the documents.</para>
              </listitem>
            </itemizedlist>
            <para>As with the algorithms, there is no hard and fast rule on which statistical distribution you should choose. Try both and use the one that yields the better results for your files.</para>
          </listitem>        
      </varlistentry>
      <varlistentry>
        <term><guilabel>Counter:</guilabel></term>
          <listitem>
            <itemizedlist>
              <listitem>
                <para><guilabel>Character</guilabel>: The basic unit used to determine the size of segments in languages that do not use a space to delimit words.</para>
              </listitem>
              <listitem>
                <para><guilabel>Word</guilabel>: The basic unit used to determine the size of segments in languages that use a space to delimit words.</para>
              </listitem>
            </itemizedlist>
            <para>The aligner automatically selects the counter based on the source and target languages of files to align. It defaults to <guilabel>Character</guilabel> if at least one of the languages involved does not delimit words with spaces, and to <guilabel>Word</guilabel> otherwise. If you are working with one of each, you can try to switch between the two to see which one yields better results.</para>          
          </listitem>        
      </varlistentry>
    </variablelist>
  
  <variablelist>
    <para><emphasis>Options</emphasis></para>
    <varlistentry>
      <term><guilabel>Segment</guilabel></term>
      <listitem>
        <para>The aligner uses sentence segmentation by default. Untick the check box to use paragraph segmentation (see <link linkend="dialogs.preferences.segmentation.setup" endterm="dialogs.preferences.segmentation.setup.title"/></para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term><guilabel>Remove Tags</guilabel></term>
      <listitem>
        <para>The aligner includes tags in the segments by default. Untick the check box to apply the <link linkend="dialogs.project.properties.remove.tags" endterm="dialogs.project.properties.remove.tages.title"/> option.</para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term><guilabel>Highlight</guilabel></term>
      <listitem>
        <para>By default, the aligner highlights all numbers in the source and target segments. Untick the check box to turn off highlighting.</para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term><guibutton>Rules...</guibutton></term>
      <listitem>
        <para>Clicking this button lets you edit the <link linkend="segmentation.rules" endterm="segementation.rules.title"/>. The general OmegaT rules are edited unless you launched the aligner from a project containing project-specific segmentation rules. This option can be useful if you defined project-specific rules to match the text of the source language and need to apply similar segmentation to the target language to get better matches.</para>
        <warning>
          <para>If you modify the segmentation rules, you will be asked if you want to save those changes when you exit the aligner. The default choice is <guibutton>Yes</guibutton>, which may not be what you want if you edited the general OmegaT segmentation rules.</para>
        </warning>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term><guibutton>Filters...</guibutton></term>
      <listitem>
        <para>This option lets you modify the <link linkend="dialogs.preferences.file.filters" endterm="dialogs.preferences.file.filters.title"/>. As with segmentation, the general OmegaT filters will be modified unless you have launched the aligner from an OmegaT project with project-specific file filter options.</para>
        <warning>
          <para>If you modify the file filters, you will be asked if you want to save those changes when you exit the aligner. The default choice is <guibutton>Yes</guibutton>, which may not be what you want if you edited the general OmegaT file filters.</para>
        </warning>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term><guibutton>Pattern...</guibutton></term>
      <listitem>
        <para>This option lets you enter a regular expression define the pattern used for highlighting text in the source and target segments. By default, the aligner uses the <literal>\d+</literal> to highlight numbers. If your texts contain other elements, such as trademarks, that would be useful to highlight, you can modify the regular expression in this dialog to inlcude those elements.</para>
        <example>
          <para>To highlight a trademark in addition to numbers, you can change the regular expression in the dialog to <literal>\d+|<emphasis>>trademark</emphasis></literal>. (Replace <emphasis>trademark</emphasis> with the actual trademark name.)</para>
          
        </example>
      </listitem>
    </varlistentry>
  </variablelist>
    
    <para>Click <guibutton>Continue</guibutton> to proceed to the next
    step.</para>
  </section>

  <section id="windows.aligner.manual.corrections">
    <title id="windows.aligner.manual.corrections.title">Step 2: Make manual
    corrections</title>

    <para>Manual adjustments are generally required after the initial
    automatic alignment process.</para>

    <para>The manual step window presents the original and translated text in
    the source and target columns, respectively.</para>

    <para>To align a source and target segment found in different rows:</para>

    <orderedlist>
      <listitem>
        <para>Select the first segment.</para>
      </listitem>

      <listitem>
        <para>Press the space bar (the shortcut for <menuchoice><guimenu>Edit</guimenu><guimenuitem>Start Pinpoint Align</guimenuitem></menuchoice>).</para>
      </listitem>

      <listitem>
        <para>Click on the corresponding segment in the other column.</para>
      </listitem>
    </orderedlist>

    <para>After repeating the process a few times, press <keycombo><keycap>C</keycap><keycap>r</keycap></keycombo> (or select <menuchoice><guimenu>Edit</guimenu><guimenuitem>Realign pending</guimenuitem></menuchoice> )to update the alignment of the remaining segments.</para>

    <para>To move one or more segments individually, select them and press
    <userinput>U</userinput> or <userinput>D</userinput> (or click the
    <guilabel>Move Up</guilabel> or <guilabel>Move Down</guilabel>
    button).</para>

    <para>Only rows with the <guilabel>Keep</guilabel> box ticked in the first
    column are saved to the translation memory.</para>

    <para>After you finish aligning the two columns, click <guibutton>Save
    TMX...</guibutton> to create the translation memory.</para>
  </section>
</section>
