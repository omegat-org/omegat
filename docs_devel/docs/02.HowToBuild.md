# Building OmegaT

OmegaT is built with Gradle. Run `gradlew tasks` from the top level to see the
available tasks. Run `gradlew build` to build all possible distfiles and run the
main tests. Tasks skipped due to missing requirements will be noted in the
output.

OmegaT will run on the latest Java, but is required to be compatible with Java 11.

Eclipse and NetBeans are recommended IDEs for working with OmegaT source
code. NetBeans is required to modify *.form-based GUI layouts (install the
Gradle Support plugin to open the OmegaT project in NetBeans.)

Check the other files in this directory for documentation. You can
produce Javadoc by running `gradlew javadoc`, or browse online:

  [https://omegat.sourceforge.io/javadoc-latest/](https://omegat.sourceforge.io/javadoc-latest/)

## Prerequisite

As in Dec., 2023, Here is a condition to build OmegaT binaries;

1. Java Development kit 11 or later. When you want to build 
   a linux deb/rpm package, JDK 17 or later is required.
2. Requires `docker` or `nerdctl` command to launch containerized processes.
   Build process for documentation and windows packages will be skipped
   when  neither `docker` nor `nerdctl` command is not found. 
3. JDK 21 has not been supported yet to launch Gradle build tool,
   but it works well as an OmegaT runtime.

## Configuring Build Tasks

Some build tasks, such as signed installers, require additional configuration
via a `local.properties` file placed at the root of the source tree. See
`local.properties.example`.

When specified a Gradle property `forceSkipDocumentBuild`, the build task 
will skip build processes to generate greeting documents, `FirstStep.html`
in languages, and bundled manuals. You can edit `local.properties` or

## Build Assets

Some build tasks require the user to supply additional files not included in the
OmegaT source. These files should be placed in the assets directory, which by
default is `..`, i.e. one level up from the OmegaT source root. You can specify
a different directory by supplying the argument `-PassetDir=/path/to/wherever`.

In particular, with-JRE builds require a JRE tarball for the appropriate
platform, e.g. `OpenJDK11U-jre-*-macosx-x64.tar.gz`.


## Containerized Tasks

Some build tasks require additional software to be installed:

- Windows installers require InnoSetup with all optional language files
- see [Build installer package and test it](93.BuildingInstallerPackage.md)

- Signed Windows installers require osslsigncode
  see [Code Signing how-to](92.CodeSigning.md)

- Manual HTML generation requires container execution environment.
  see [How to build HTML manuals from source](07.ManualContainerTaskBuild.md)

## Working with Dependencies

OmegaT uses Gradle to manage and fetch dependencies automatically. To add,
change, or remove a dependency, see the dependencies block in build.gradle.

Dependency JARs are provided in the "source" distribution of OmegaT under
/lib/provided, as insurance in case any dependencies should become unavailable
online. When /lib/provided is present, compile-time dependencies will be
resolved locally, minimizing network access (network access is still required
for initializing the Gradle wrapper, fetching Gradle plugins, and fetching test
dependencies).


## Customized Dependencies

OmegaT uses unmodified packages as much as possible, but when modifications are
required and the upstream project is abandoned or unresponsive, custom-patched
libraries are also used.

Patched forks can be found on GitHub:
  [https://github.com/omegat-org](https://github.com/omegat-org)

In some cases (especially defunct projects) OmegaT forks are also published for
general use on Maven Central:
  [https://search.maven.org/search?q=g:org.omegat*](https://search.maven.org/search?q=g:org.omegat*)

Dependencies not available for consumption via Maven/Gradle are committed to
/lib/manual.

## Basic build tasks

You can see defined tasks with a command `./gradlew tasks`
If you use IDEs that support Gradle, such as Eclipse, Apache NetBeans or Jetbrains IntelliJ,
IDEs will show you a list of tasks.

```console

------------------------------------------------------------
Tasks runnable from root project 'OmegaT'
------------------------------------------------------------

Application tasks
-----------------
debug - Launch app for debugging.
run - Runs this project as a JVM application
runOnJava17 - Launch app on Java 17
runOnJava21 - Launch app on Java 21

Build tasks
-----------
assemble - Assembles the outputs of this project.
build - Assembles and tests this project.
buildDependents - Assembles and tests this project and all projects that depend on it.
buildNeeded - Assembles and tests this project and all projects it depends on.
classes - Assembles main classes.
clean - Deletes the build directory.
jar - Assembles a jar archive containing the classes of the 'main' feature.
javaClasses - Assembles java classes.
javadocJar - Assembles a jar archive containing the main javadoc.
sourcesJar - Assembles a jar archive containing the main sources.
testClasses - Assembles test classes.
testFixturesClasses - Assembles test fixtures classes.
testFixturesJar - Assembles a jar archive containing the classes of the 'testFixtures' feature.
testIntegrationClasses - Assembles test integration classes.

Build Setup tasks
-----------------
init - Initializes a new Gradle build.
wrapper - Generates Gradle wrapper files.

Distribution tasks
------------------
assembleDist - Assembles the main distributions
assembleSourceDist - Assembles the source distributions
distTar - Bundles the project as a distribution.
distZip - Bundles the project as a distribution.
installDist - Installs the project as a distribution as-is.
installLinux64Dist - Create a linux installDist for linux64. 
installLinuxArm64Dist - Create a linux installDist for linuxArm64. 
installSourceDist - Installs the project as a distribution as-is.
linuxDebDist
linuxRpmDist
macArmInstallDist - Build a Mac distribution.
macArmInstallSignedDist - Build a signed Mac distribution. Requires an Apple Developer Account.
macX64InstallDist - Build a Mac distribution.
macX64InstallSignedDist - Build a signed Mac distribution. Requires an Apple Developer Account.
sourceDistTar - Bundles the project as a distribution.
sourceDistZip - Bundles the project as a distribution.

Documentation tasks
-------------------
firstSteps - Build First pages for all languages at docs/greetings/. Requires Docker.
genDocIndex - Generate the docs index file
javadoc - Generates Javadoc API documentation for the 'main' feature.
manualHtmls - Build HTML manuals and zip for all languages. Requires container runtime.
manualPdfs - Build PDF manuals for all languages. Requires container runtime.
manualZips - Build ZIP manuals to bundle into application. Requires container runtime.
testFixturesJavadoc - Generates Javadoc API documentation for the 'testFixtures' feature.
updateManuals - Update Instant Start guides and HTML manuals.
webManual - Sync the HTML manual files

Gradle Enterprise tasks
-----------------------
buildScanPublishPrevious - Publishes the data captured by the last build.
provisionGradleEnterpriseAccessKey - Provisions a new access key for this build environment.

Help tasks
----------
buildEnvironment - Displays all buildscript dependencies declared in root project 'OmegaT'.
dependencies - Displays all dependencies declared in root project 'OmegaT'.
dependencyInsight - Displays the insight into a specific dependency in root project 'OmegaT'.
dependencyUpdates - Displays the dependency updates for the project.
help - Displays a help message.
javaToolchains - Displays the detected java toolchains.
outgoingVariants - Displays the outgoing variants of root project 'OmegaT'.
projects - Displays the sub-projects of root project 'OmegaT'.
properties - Displays the properties of root project 'OmegaT'.
resolvableConfigurations - Displays the configurations that can be resolved in root project 'OmegaT'.
tasks - Displays the tasks runnable from root project 'OmegaT' (some of the displayed tasks may belong to subprojects).

IDE tasks
---------
cleanEclipse - Cleans all Eclipse files.
eclipse - Generates all Eclipse files.

Launch4j tasks
--------------
createAllExecutables - Runs all tasks that implement DefaultLaunch4jTask
createExe - Runs the launch4j jar to generate an .exe file

Omegat distribution tasks
-------------------------
linux - Build the Linux distributions.
linux64DistTarBz - Create a Linux distribution for linux64. 
linuxArm64DistTarBz - Create a Linux distribution for linuxArm64. 
mac - Build the Mac distributions.
macArmDistZip - Create Mac distribution for macArm
macArmSignedDistZip
macX64DistZip - Create Mac distribution for macX64
macX64SignedDistZip
win - Build the Windows distributions.
winJRE64Signed
winJRESigned
winNoJRESigned

Omegat release tasks
--------------------
publishJavadoc - Copy javadoc to SourceForge web.
publishManual - Copy manual to SourceForge web.
publishVersion - Update the version considered current by the version check.

Omegat workflow tasks
---------------------
spotlessChangedApply - Apply code formatting to files that have been changed on the current branch.
testIntegration - Run integration tests. Pass repo URL as -Domegat.test.repo=<repo>

Publishing tasks
----------------
generateMetadataFileForMavenJavaPublication - Generates the Gradle metadata file for publication 'mavenJava'.
generatePomFileForMavenJavaPublication - Generates the Maven POM file for publication 'mavenJava'.
publish - Publishes all publications produced by this project.
publishAllPublicationsToMavenRepository - Publishes all Maven publications produced by this project to the maven repository.
publishMavenJavaPublicationToMavenLocal - Publishes Maven publication 'mavenJava' to the local Maven repository.
publishMavenJavaPublicationToMavenRepository - Publishes Maven publication 'mavenJava' to Maven repository 'maven'.
publishToMavenLocal - Publishes all Maven publications produced by this project to the local Maven cache.

Verification tasks
------------------
check - Runs all checks.
jacocoTestCoverageVerification - Verifies code coverage metrics based on specified rules for the test task.
jacocoTestReport - Generates code coverage report for the test task.
spotbugsJava - Run SpotBugs analysis for the source set 'java'
spotbugsMain - Run SpotBugs analysis for the source set 'main'
spotbugsMainReport
spotbugsTest - Run SpotBugs analysis for the source set 'test'
spotbugsTestFixtures - Run SpotBugs analysis for the source set 'testFixtures'
spotbugsTestIntegration - Run SpotBugs analysis for the source set 'testIntegration'
spotbugsTestReport
spotlessApply - Applies code formatting steps to sourcecode in-place.
spotlessCheck - Checks that sourcecode satisfies formatting steps.
spotlessDiagnose
spotlessJava
spotlessJavaApply
spotlessJavaCheck
spotlessJavaDiagnose
test - Runs the test suite.
testOnJava17 - Run test cases on Java 17
testOnJava21 - Run test cases on Java 21

Other tasks
-----------
jpackage

Rules
-----
Pattern: clean<TaskName>: Cleans the output files of a task.
Pattern: build<ConfigurationName>: Assembles the artifacts of a configuration.

```

Most tasks have an explanation what it does.

### I want to run OmegaT with some modification

There are two major ways to build and execute OmegaT from source.

1. use application tasks

There are `run`, `runOnJava17` and `runOnJava21` tasks.
It will compile core of OmegaT and all modules, first steps documents, and place module jars in `build/modules` folder 
and launch a main function from source.
You can add command line argument to Gradle command by `--args="lorem ipsum dolor"`.

Here is an example 
```console
./gradlew run --args="-Xmx4096M --add-opens java.desktop/sun.awt.X11=ALL-UNNAMED  -Duser.language=ja -Duser.country=JP"
```
2. use installDist task

When running `installDist` task, OmegaT build system compiles core of OmegaT, all modules, first step pages, bundled 
manuals, and copy files with installed structure in `build/install/OmegaT/`
You can open a terminal in the folder, and launch OmegaT.

Here is an example
```console
./gradlew installDist

cd build/install/OmegaT/
./OmegaT
```

### I want to build a specific module

You can build a specific modules jar, by specified `modlue::task` syntax.

Here is an example
```console
./gradlew aligner:jar
```

When build finished, Please check `build/modules/` and you will find `aligner-omegat.jar` file.

### I want to build HTML manual in my language

There are `manualHtmlXX`, here `XX` is 2-letter language code such as En, Ca, Fr.
When you want to build html manuals in all supported languages, you can use `manualHtlms` task.


## Speed-up build OmegaT project

We provide several ways and technics to speed up build-and-try cycles.

### Skip containerized manual build

When you are a developer interested in some specific features, but not on manual documents, you can take two options.

1. When you don't install container support software, document build is always skipped.
2. When you specify a property in Gradle command line `-PforceSkipDocumentBuild`, document build will be skipped.

You will see "SKIPPED" label with a reason in a task execution log.

### Smart task execution

OmegaT build system is configured to work Gradle task smart build feature.
Once you run a build task, such as making jar, and HTML manuals, then modified some code, Gradle will skip all the 
unchanged parts of the project, and compile and generate jar required.
You will see some label in a build log. These labels are based on if a task has actions to execute,
if it should execute those actions, if it did execute those actions and if those actions made any changes.

- (no label) or EXECUTED

    Task executed its actions.

- UP-TO-DATE

    Task’s outputs did not change.

- FROM-CACHE

    Task’s outputs could be found from a previous execution.

- SKIPPED

    Task did not execute its actions.

- NO-SOURCE

    Task did not need to execute its actions.

### Modular architecture

OmegaT project source tree is configured as multi-project format. When building OmegaT, Gradle build system run
compile and other tasks concurrently among subprojects. OmegaT has several *modules* which are bundled plugins,
that are handled in parallel way. Gradle will use as many cores as PC has.

### Complex features in dependencies

OmegaT has many filters, machine translation connectors, dictionary drivers and so on. A core part of these features
is considered as useful for other Free Software projects. It is the reason why core developers create library projects
which support file formats, Web services, and GUI parts.
These have already built in another place, and been downloaded from maven central repository.

