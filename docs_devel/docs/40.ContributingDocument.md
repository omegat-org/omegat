# Contributing OmegaT documentation

OmegaT Manuals and User guides are co-developed on OmegaT program repository.

You can see a document source in`doc_src/` folder in OmegaT project source code repository.

## Documentation rules and procedures

Please contact to [Documentation manager](https://omegat.org/about) at [omegat-development mailing list]
(https://sourceforge.net/projects/omegat/lists/omegat-development) for details.

## manual snapshot release

When developer update manuals in source code, CI/CD automatically build HTML manuals and published
on web server. You can see snapshot version of HTML manual at https://omegat.sourceforge.io/manual-snapshot/

## How to build HTML manuals from source

### requirement

OmegaT project provides a Gradle configuration to build manuals using container execution environment.

Theoretically, all the OCI-compatible container execution environments are supported for building manuals.
We tested it with a [Docker Desktop](https://www.docker.com/products/docker-desktop) product sold by Docker 
Inc., and with Open Source software [contaienrd and nerdctl](https://github.com/containerd/nerdctl).

When you don't have a docker or nerdctl command, OmagaT build system skips all the generation of documentation.

#### Get docker desktop and install 

Get Docker desktop without needing to make an account:

- [Docker Desktop for Windows](https://docs.docker.com/docker-for-windows/install/#install-docker-desktop-for-windows-desktop-app)
- [Docker Desktop for Mac](https://docs.docker.com/docker-for-mac/release-notes/)
- [Docker Desktop for Linux](https://docs.docker.com/desktop/install/linux-install/)

#### Container runtimes

Commercial use of Docker Desktop in larger enterprises requires a paid subscription.

[OCI, Open Container Initiative, standardized Linux container image and its runtime](https://opencontainers.org/).
.
Thanks to the standard and FLOSS community, there are several alternatives
than Docker Desktop product.

- Runtime environment: containerd, kubernetes
- Toolset: nerdctl, podman
- Integrated environment: Rancher Desktop

OmegaT supports both `nerdctl` and `docker` command.

#### Rancher Desktop on macOS

You are recommended to check Rancher Desktop when you want to use on macOS.
Rancher Desktop is an Electron-based application that wraps other tools while providing a simple user experience.
On macOS, Rancher Desktop uses a virtual machine to run containerd or Docker and Kubernetes.
It provides custom Lima machines with `nerdctl` on macOS.

Lima project provides Linux virtual machines for macOS, with built-in integration for nerdctl.
There is an alternative project colima, that means "container on Linux on Mac" that provides
container runtimes on macOS with minimal setup.

Rancher desktop supports both intel mac and arm mac.

- [Rancher Desktop](https://rancherdesktop.io/)
- [colima](https://github.com/abiosoft/colima)

#### Docker Desktop on macOS

Please consult with Docker Inc. or docker user community for instructions,
and make `docker` command working.

#### Rancher Desktop on Windows

You are recommended to check Rancher Desktop when you want to use container on Windows, because we
prefer Free Software. It uses `containerd` on WSL2 and `nerdctl` on Windows.

- [Rancher Desktop](https://rancherdesktop.io/)

#### Docker Desktop on Windows

Please consult with Docker Inc. or docker user community for instructions,
and make `docker` command working.

#### containerd/nerdctl on Linux

You can use containerd system and nerdctl command in native package.
OmegaT build system supports rootless mode of containerd/nerdctl.

Here explains installation of rootless mode.

##### Installation of containerd/nerdctl

Download release file from [the project](https://github.com/containerd/nerdctl/releases)

```bash
tar Cxzvvf /usr/local nerdctl-full-1.7.2-linux-amd64.tar.gz
```

##### Installation of rootless containerd daemon

Use [`containerd-rootless-setuptool.sh`](https://github.com/containerd/nerdctl/tree/main/extras/rootless) to set up 
rootless containerd.

```bash
$ containerd-rootless-setuptool.sh install
[INFO] Checking RootlessKit functionality
[INFO] Checking cgroup v2
[INFO] Checking overlayfs
[INFO] Creating /home/testuser/.config/systemd/user/containerd.service
...
[INFO] Installed containerd.service successfully.
[INFO] To control containerd.service, run: `systemctl --user (start|stop|restart) containerd.service`
[INFO] To run containerd.service on system startup, run: `sudo loginctl enable-linger testuser`

[INFO] Use `nerdctl` to connect to the rootless containerd.
[INFO] You do NOT need to specify $CONTAINERD_ADDRESS explicitly.
```

- [Rootless mode nerdctl](https://github.com/containerd/nerdctl/blob/main/docs/rootless.md)

##### Installation of Rancher Desktop on Linux

You can download the release of Rancher Desktop from Web page.
There are Ubuntu/Debian package, Fedora package, and AppImage package.
When installation of the package, all the dependencies are also installed.

- [Rancher Desktop](https://rancherdesktop.io/)

#### Execution of command

When requirements are satisfied, we can build documents.
When you install container execution environment, please don't forget to launch Rancher desktop
before OmegaT build procedure.

You can use Gradle Build System for generating manuals and publish tasks.

##### generating firstSteps

It is recommended to migrate first_steps.html for first screen message in OmegaT 6.0 and later 

```bash
$ ./gradlew firstSteps
```

You will find generated pages in `build/docs/greetings/<lang>/`

##### generating instantStartGuides

OmegaT 5.x and before uses instant start guide.

```bash
$ ./gradlew instantStartGuides
```

You will find generated pages in `build/docs/greetings/<lang>/`

##### generating HTML manuals and first pages for review

```bash
$ ./gradlew updateManuals
```

This generates all first pages and manuals for all languages.

You can open a HTML manual from `build/docs/manual/index.html`

## Document generation under the hood

Document generation is done with `ant` build configuration in `docgen` container image.
 `doc_src/docgen` is a shell script that is launched from Gradle build system.
Arguments to `docgen` are the same as the arguments to `ant` described below in the Usage section.

See also:

- [docgen-docker](https://github.com/omegat-org/docgen-docker): source for the docgen container

## Inside container image

### Dependencies

The creation of the documentation requires a number of tools:

- DocBook XSL Stylesheets 1.75.2 ("dbk") or above
  [https://github.com/docbook/xslt10-stylesheets](https://github.com/docbook/xslt10-stylesheets)
- DocBook XML 4.5 ("docbook-xml-4.5")
  [https://docbook.org/xml/4.5/](https://docbook.org/xml/4.5/)
- fop 1.1 ("fop-1.1")
  [https://xmlgraphics.apache.org/fop/1.1/](https://xmlgraphics.apache.org/fop/1.1/)
- libxml2 2-2.7.7 ("libxml2-2.7.7")
  [http://xmlsoft.org](http://xmlsoft.org)
- Saxon 6-5-5 ("saxon")
  [https://sourceforge.net/projects/saxon/files/saxon6/](https://sourceforge.net/projects/saxon/files/saxon6/)
- XMLmind Web Help Compiler ("whc")
  [https://www.xmlmind.com/ditac/whc.shtml](https://www.xmlmind.com/ditac/whc.shtml)
- Ant 1.7.1 or above ("apache-ant")
  [https://ant.apache.org](https://ant.apache.org)

### Path to the DTD

For efficiency reason, the path to the DTD in the DocBook files (e.g.,
`AboutOmegaT.xml`) has been changed to a local path
(`../../../docbook-xml-4.5/docbookx.dtd` instead of an `http://`
reference). Depending on the actual configuration, it might be changed to a
standard reference (`http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd`) or
to another local reference.

### Windows

dbk must be installed at the root of `C:`

    C:\dbk\common
    C:\dbk\docsrc
    ⋮

docbook-xml-4.5 must be installed at the same level as your OmegaT development
folder.

So, if you have

    C:\dev\omegat-trunk
    C:\dev\omegat-trunk\src
    C:\dev\omegat-trunk\doc_src
    ⋮

you would have

    C:\dev\docbook-xml-4.5\ent
    C:\dev\docbook-xml-4.5\calstblx.dtd
    ⋮

libxml2-2.7.7 and apache-ant must be installed where a path can find them,
usually in Program Files.

    C:\Program Files\libxml2-2.7.7.win32
    C:\Program Files\apache-ant

Corresponding `path`:

    path=C:\Program Files\libxml2-2.7.7.win32\bin;C:\Program Files\apache-ant\bin

fop-1.1 can be installed anywhere, usually in Program Files.

    C:\Program Files\fop-1.1

The location of fop-1.1, dbk and Saxon must be set in `doc_src_paths.xml`,
in the corresponding properties:

    <property name="fop.home" value="C:\Program Files\fop-1.1" />

Alternatively, it is possible to set the values of `fop.home.lib` and
`fop.home.build` separately:

    <property name="fop.home.lib" value="C:\Program Files (x86)\fop-1.1\lib" />
    <property name="fop.home.build" value="C:\Program Files (x86)\fop-1.1\build" />

    <property name="dbk" value="c:\dbk" />
    <property name="saxon" value="C:\Program Files\saxon6-5-5\saxon.jar" />

The location of dbk must also be set in `docbook-utf8.xsl`:

    <xsl:import href="file:///c:\dbk\html\docbook.xsl"/>

Both `doc_src_paths.xml` and `docbook-utf8.xsl` must be copied at the same level
as your OmegaT development folder.

    C:\dev\doc_src_paths.xml
    C:\dev\docbook-utf8.xsl

The ones available in `doc_src` are only there for reference.

### macOS

#### Dependencies

All the dependencies can be installed through
[MacPorts](https://www.macports.org/) except for saxon and whc.

    sudo port install apache-ant docbook-xml-4.5 docbook-xsl-nons fop libxml2

- Saxon 6-5-5 ("saxon")
  [https://sourceforge.net/projects/saxon/files/saxon6/](https://sourceforge.net/projects/saxon/files/saxon6/)

- XMLmind Web Help Compiler ("whc")
  [https://www.xmlmind.com/ditac/whc.shtml](https://www.xmlmind.com/ditac/whc.shtml)

Unzip the downloaded packages and put them in your prefered location. The
example below uses the `/Applications` folder.

#### Paths

If you use Macports, the `doc_src_paths.xml` settings are:

    <project>
        <property name="fop.home" value="/opt/local/share/java/fop/1.1" />
        <property name="dbk" value="/opt/local/share/xsl/docbook-xsl-nons" />
        <property name="saxon" value="/Applications/saxon6-5-5/saxon.jar" />
	    <property name="whc" value="/Application/whc-3_3_0/lib/whc.jar" />
    </project>

and the `docbook-utf8.xsl` settings are:

    <xsl:import href="file:///opt/local/share/xsl/docbook-xsl-nons/html/docbook.xsl"/>

#### DocBook 4.5 installation

Create a symbolic link from the installed DocBook 4.5 files to the location
where the build process will look for the DocBook DTD: the folder "above"
`doc_src` in the OmegaT source tree:

    ln -s /opt/local/share/xml/docbook/4.5 /path/to/omegat/docbook-xml-4.5

#### Settings files

The modified `doc_src_paths.xml` and `docbook-utf8.xsl` must be copied to the
same location as `docbook-xml-4.5`.

    /path/to/omegat/doc_src/en/
       └────/docbook-xml-4.5/
       └────/doc_src_paths.xml
	   └────/docbook-utf8.xsl

# Fonts
The following fonts must be installed:

- Latin: [DejaVu Sans](https://dejavu-fonts.github.io/)
- Japanese: [IPA P
  Gothic](https://ipafont.ipa.go.jp/old/ipafont/download.html#en)
- Chinese: [WenQuanYi Micro
  Hei](http://wenq.org/wqy2/index.cgi?action=browse&id=Home&lang=en)

# Usage

All the scripts require the language folder as argument and must be run from the
`doc_src` directory.

Note: Replace `ant` with `docgen` if you are using the `docgen` script.

## Building First Steps only

    ant -Dlanguage=en first-steps

## Building everything except Javahelp:

    ant -Dlanguage=en

## Building HTML

    ant -Dlanguage=en html5

## Building PDF

    ant -Dlanguage=en pdf

## Building Javahelp

    ant -Dlanguage=en javahelp

# Scripts

- `build.xml`: Main script
- `doc_src_paths.xml`: Set the paths for utilities
- `docbook-utf8.xsl`: Allows to issue the First Steps in UTF-8


### License

All the files in `doc_src` folder and below are under the terms of the GNU General
Public License as published by the Free Software Foundation; either version 3 of
the License, or (at your option) any later version.

When combining works licensed under CC BY-SA 4.0 with our manual, you should use caution and make sure that they can
actually comply with the source requirements of GPLv3, specifically that they are able to show that they can provide the
source code, which is defined as the preferred form of the work for making modifications.
You are also warned that a CC-BY-SA 4.0 compatibility with GPLv3 is one-way. When there is a good modification in
our manual that is valuable for your original CC BY-SA artifact, you cannot feed it back to the original.
