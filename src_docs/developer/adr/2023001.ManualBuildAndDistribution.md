# ADR: Manual Build and Distribution for OmegaT

## Status
**Accepted** – Fully Implemented

## Context

The OmegaT project currently includes manuals within the distribution, stored as HTML files in language-specific subfolders under the `docs` directory.
This implementation has some drawbacks:

1. **Size of Distribution**:
    - The current manual files increase the distribution size unnecessarily.
    - Unused or redundant files such as images, CSS, or JS files contribute to bloat.

2. **Accessibility**:
    - To improve accessibility, an online manual is proposed for users preferring web access.
    - However, OmegaT is expected to function offline, and viewing manuals offline is necessary for core functionality.

3. **Localization Challenges**:
    - Packaging relevant language tools (e.g., spellcheck dictionaries) with manuals in different languages is currently inefficient.

4. **Build Complexity**:
    - The manual build workflow relies on outdated tools (e.g., DocBook 4.5, XSLT 1.0, and Saxon 6).

## Decision

To address these issues, the OmegaT team will move to a new manual distribution and build approach:

1. **Manual Distribution as ZIP Packages**:
    - Each language manual will be distributed as a zipped file with HTML files, reduced assets (optimized images, shared CSS/JS), and additional language tools (e.g., spellchecking dictionaries).
    - Manuals will be extracted temporarily from the ZIP file when accessed via `Help > Manual` in OmegaT or offline systems for local browsing.

2. **Online and Offline Accessibility**:
    - Users can browse manuals directly from the OmegaT website for convenience.
    - Offline access is still maintained to ensure core functionality without requiring an internet connection.

3. **Build System Update**:
    - Create a Gradle-based manual build system independent of Docker or other containerized environments.
    - Dependencies for legacy libraries (e.g., Saxon, DocBook) will be updated and republished as part of OmegaT’s Maven repository.

4. **Folder Structure Update for Documentation and Code**:
    - Relocate manual/documentation sources to a Gradle-compatible directory structure (`src/docs/manual/<lang>`).
    - Align the Java source (`src/`) and test files (`test/`) with the Maven/Gradle directory layout standard (`src/main/java`, `src/test/java`).

## Consequences

### Positive Outcomes

- **Reduced Distribution Size**:
    - Distributing zipped manuals significantly decreases overall distribution size by eliminating redundant/unnecessary files.
- **Offline and Online Flexibility**:
    - Users have the choice of accessing manuals online or offline, enhancing versatility based on user scenarios.
- **Improved Developer Experience**:
    - Adoption of Gradle standards streamlines the build process.
- **Optimized Resource Usage**:
    - Shared assets (CSS, JS) and optimized images reduce duplication and file size.
- **Future Scalability**:
    - The modular Gradle-based build system allows easy updates and optimizations.

### Negative Trade-offs
- **Increased Build Complexity**:
    - Transitioning to the new build system introduces a learning curve for developers unfamiliar with Gradle or XSLT workflows.
- **Migration Effort**:
    - Requires significant developer effort to refactor existing source, test, and documentation structures.

## Alternatives Considered

1. **Retaining the Current System**:
    - Pro: No additional effort required.
    - Con: Does not solve distribution size, redundancy, and developer workflow challenges.

2. **Fully Web-Based Documentation**:
    - Pro: Simplified distribution.
    - Con: Offline functionality would no longer be available, which is unacceptable for some users.

3. **Remove Manuals from Distribution Completely**:
    - Pro: Simplifies distribution and reduces size substantially.
    - Con: Critically impacts usability for offline use.

## Implementation Details

1. **Manual Build Workflow**:
    - The Gradle build will generate:
        - Language-specific zipped archives.
        - Extracted HTML manuals for testing/development.
    - Required libraries (e.g., Saxon, Libstemmer) will be maintained under OmegaT’s Maven repository.

2. **Manual Updates and Release**:
    - Developers submit manual updates in XML DocBook format.
    - Zipped archives are published alongside OmegaT releases.

3. **Folder Structure Changes**:
    - Manual source files: `src/docs/manual/<lang>/`
    - Gradle build scripts (`build.gradle`, `settings.gradle`) to reflect the updated folder structure.

## Risks and Mitigation

- **Backward Compatibility**:
    - Ensure OmegaT can still access old manuals by bundling default language ZIPs in distributions.
    - Provide documentation for offline usage and manual extraction.
- **Tooling Compatibility**:
    - Verify build process compatibility across environments (Windows, macOS, Linux).

## Adoption Plan

1. Migrate manual source to the updated folder structure (`src/docs/manual/`).
2. Implement Gradle build scripts for manual generation/testing.
3. Publish initial language-specific manual ZIP distributions with OmegaT’s next release.

## References

- GitHub PRs:
    - [#705](https://github.com/omegat-org/omegat/pull/705)
    - [#1284](https://github.com/omegat-org/omegat/pull/1284)
- Gradle and Build Directory Layout:
    - [Gradle Directory Layout Documentation](https://docs.gradle.org/current/userguide/organizing_gradle_projects.html)

**Date**: June 26, 2025  
**Author**: Hiroshi Miura  
**Reviewers**: OmegaT Development Team